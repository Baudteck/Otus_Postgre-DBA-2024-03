### Домашнее задание к уроку "Работа с уровнями изоляции транзакции в PostgreSQL"

1. Для работы с PostgreSQL была создана виртуальная машина под управлением OS Ubuntu 22.04, после чего на неё был установлен PostgreSQL версии 14.11.
2. Был добавлен ssh-ключ и выполнены остальные рекомендованные домашним заданием подготовительные процедуры.
3. Для того, чтобы меньше путаться в сессиях были созданы два конфигурационных файла со следующим содержимым: 
- .psqlrc_1
```
\set PROMPT1 '(1) %/%R%x%# '
\set PROMPT2 '(1) %/%R%x%# '
```
- .psqlrc_2
```
\set PROMPT1 '{2} %/%R%x%# '
\set PROMPT2 '{2} %/%R%x%# '
```
В дальнейшем это позволило по подсказке различать сессии с БД.

4. Была запущена сессия №1: \
`export PSQLRC=~/.psqlrc_1; psql -U postgres` и создана отдельная БД: \
 `CREATE DATABASE "Lesson 02";`.
5. Аналогичным образом запущена вторая сессия: \
 `export PSQLRC=~/.psqlrc_2; psql -U postgres`.
6. В обеих сессиях выключена автоматическая фиксация изменений: `\set AUTOCOMMIT off`.
7. В первой сессси была создана и наполнена данными таблица:
```
CREATE TABLE persons(id serial, first_name text, second_name text); 
INSERT INTO persons(first_name, second_name) VALUES('Остап', 'Бендер'); 
INSERT INTO persons(first_name, second_name) VALUES('Ипполит', 'Воробьянинов'); 
```
после чего транзакция была зафиксирована.

8. Текущий уровень изоляции транзакций соответствовал настройкам по умолчанию:
```
 SHOW TRANSACTION ISOLATION LEVEL;
 transaction_isolation
-----------------------
 read committed
(1 row)
```

9. В обеих сессиях были начаты новые транзакции, а в первой произведена вставка третьей строки в таблицу:
```
INSERT INTO persons(first_name, second_name) VALUES('Фёдор', 'Востриков'); 
```

10. Запрос `"SELECT * FROM persons;"`,  выполненный во второй сессии ожидаемо вернул две строки:
```
 SELECT * FROM persons;
 id | first_name | second_name
----+------------+--------------
  1 | Остап      | Бендер
  2 | Ипполит    | Воробьянинов
(2 rows)
```
так как текущий уровень изоляции позволяет видеть только зафиксированные изменения, а транзакция в первой сессии ещё активна.

11. После фиксации изменений первой сессии, во второй стали видны все три строки:
```
 SELECT * FROM persons;
 id | first_name | second_name
----+------------+--------------
  1 | Остап      | Бендер
  2 | Ипполит    | Воробьянинов
  3 | Фёдор      | Востриков
(3 rows)
```
так как первая транзакция зафиксировала свои изменения и они стали доступны везде, в том числе и во второй сессии.

12. В обеих сессиях были начаты транзакции с другим уровнем изоляции: `"SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;"`
13. В сессии №1 была вставлена ещё одна строка в таблицу: `INSERT INTO persons(first_name, second_name) VALUES('Элла', 'Щукина');`.
14. Количество строк таблицы, видимых во второй сесии осталось прежним:
```
 SELECT * FROM persons;
 id | first_name | second_name
----+------------+--------------
  1 | Остап      | Бендер
  2 | Ипполит    | Воробьянинов
  3 | Фёдор      | Востриков
(3 rows)
```
так как уровень REPEATABLE READ предполагает видимость только тех изменений, которые уже были зафиксированы до начала текущей транзакции.

15. В первой сессии были сохранены изменения, произведённые вставкой четвёртой строки, после чего во второй сессии вновь были выбраны все строки из таблицы:
```
 SELECT * FROM persons;
 id | first_name | second_name
----+------------+--------------
  1 | Остап      | Бендер
  2 | Ипполит    | Воробьянинов
  3 | Фёдор      | Востриков
(3 rows)
```
Их количество не изменилось, потому что текущий уровень изоляции (REPEATABLE READ) предполагает получение неизменного набора строк, т.е. повторяемое с одним и тем же результатом чтение за всё время жизни текущей транзакции. 

16. Наконец мы завершаем транзакцию во второй сессии и теперь нам здесь видны все 4 строки таблицы:
```
 SELECT * FROM persons;
 id | first_name | second_name
----+------------+--------------
  1 | Остап      | Бендер
  2 | Ипполит    | Воробьянинов
  3 | Фёдор      | Востриков
  4 | Элла       | Щукина
(4 rows)
```
Это произошло потому, что в сессии №2 завершена ранее запущенная транзакция, уровень которой гарантировал нам повторяемый результат чтения, т.е. своеобразную защиту от изменений, произведённых другими транзакцями и мы, можно сказать, вернулись в реальный мир.
